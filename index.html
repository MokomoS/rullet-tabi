<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ«ãƒ¼åˆ—å³¶æ—… ãƒã‚¯ã‚¹ãƒˆï¼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles */
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            background-color: #f0f4f8; /* Light blue-gray background */
            color: #1e293b; /* Dark slate text */
        }

        /* SVG Map Styling */
        .svg-wrapper {
            max-width: 600px; /* Adjust as needed */
            margin: 2rem auto;
            border: 1px solid #cbd5e1; /* Slate-300 border */
            border-radius: 0.5rem;
            background-color: #ffffff; /* White background for map */
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            overflow: hidden; /* Ensure SVG stays within rounded corners */
        }
        .svg-wrapper svg {
            display: block;
            width: 100%;
            height: auto;
        }
        #mapContainer path,
        #mapContainer circle {
            fill: #e2e8f0; /* Default fill color (Slate-200) */
            stroke: #94a3b8; /* Stroke color (Slate-400) */
            stroke-width: 0.5;
            transition: fill 0.3s ease;
            cursor: pointer;
        }
        #mapContainer path:hover,
        #mapContainer circle:hover {
            fill: #bfdbfe; /* Lighter blue on hover (Blue-200) */
        }
        .highlighted-prefecture {
            fill: #3b82f6 !important; /* Highlight color (Blue-500) */
            animation: pulse 2s ease-in-out;
        }
        .start-prefecture {
             fill: #f59e0b !important; /* Start color (Amber-500) */
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.02); }
        }

        /* Dice animation */
        #diceImage {
            transition: transform 0.1s ease-in-out;
        }
        .dice-rolling {
            animation: roll 0.5s linear infinite;
        }
        @keyframes roll {
            0% { transform: rotate(0deg) scale(1); }
            100% { transform: rotate(360deg) scale(1.1); }
        }

        /* Weather Icons (Simple placeholders) */
        .weather-icon {
            width: 40px;
            height: 40px;
            display: inline-block;
            vertical-align: middle;
            margin-right: 0.5rem;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }
        .weather-sunny { background-image: url('https://placehold.co/40x40/facc15/1e293b?text=â˜€ï¸'); } /* Amber-400 */
        .weather-cloudy { background-image: url('https://placehold.co/40x40/94a3b8/1e293b?text=â˜ï¸'); } /* Slate-400 */
        .weather-rainy { background-image: url('https://placehold.co/40x40/60a5fa/1e293b?text=ğŸŒ§ï¸'); } /* Blue-400 */
        .weather-snowy { background-image: url('https://placehold.co/40x40/e0f2fe/1e293b?text=â„ï¸'); } /* Cyan-100 */
        .weather-default { background-image: url('https://placehold.co/40x40/cbd5e1/1e293b?text=?'); } /* Slate-300 */

        /* General Section Styling */
        section {
            background-color: #ffffff;
            padding: 1.5rem; /* p-6 */
            margin-bottom: 1.5rem; /* mb-6 */
            border-radius: 0.5rem; /* rounded-lg */
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
        }

        /* Button Styling */
        button, select {
            transition: all 0.2s ease-in-out;
        }
        button:hover:not(:disabled) {
            opacity: 0.85;
            transform: translateY(-1px);
        }
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Share Button Specific */
        #shareBtn img {
            width: 16px;
            height: 16px;
            margin-right: 8px;
            vertical-align: text-bottom;
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">

  <header class="text-center mb-8">
    <h1 class="text-3xl md:text-4xl font-bold mb-4 text-blue-600">ãƒ«ãƒ¼åˆ—å³¶æ—… ãƒã‚¯ã‚¹ãƒˆï¼</h1>
    <p class="text-slate-600 max-w-md mx-auto">
      1. ã‚¹ã‚¿ãƒ¼ãƒˆåœ°ç‚¹ã‚’é¸ã‚“ã§ã­ï¼<br>
      2. è¡Œãå…ˆãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã‚’å›ãã†ï¼<br>
      3. äºˆç®—ãƒ€ã‚¤ã‚¹ã§é‹è©¦ã—ï¼<br>
      â€»ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã®çµæœã¯å¸¸ã«ã‚¹ã‚¿ãƒ¼ãƒˆåœ°ç‚¹ã¨éš£æ¥ã—ãŸéƒ½é“åºœçœŒã«ãªã‚‹ã‚ˆï¼
    </p>
  </header>

  <main class="max-w-4xl mx-auto">

    <section id="startSection" class="flex flex-col sm:flex-row items-center justify-center gap-4">
      <label for="startPref" class="font-medium text-slate-700">ã‚¹ã‚¿ãƒ¼ãƒˆåœ°ç‚¹:</label>
      <select id="startPref" class="p-2 border border-slate-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
        </select>
    </section>

    <section id="mapSection">
      <h2 class="text-xl font-semibold mb-4 text-center text-slate-700">åœ°å›³ (ã‚¯ãƒªãƒƒã‚¯ã§ã‚¹ã‚¿ãƒ¼ãƒˆåœ°ç‚¹å¤‰æ›´)</h2>
      <div id="mapContainer">
          <div class="text-center text-slate-500">åœ°å›³ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
      </div>
    </section>

    <section id="rouletteSection" class="text-center">
      <button id="destinationBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg shadow mb-4">
        è¡Œãå…ˆãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã‚’å›ã™ï¼
      </button>
      <div id="destinationResult" class="text-2xl font-semibold min-h-[3rem] flex items-center justify-center text-blue-700">
        </div>
    </section>

    <section id="weatherSection" class="hidden">
        <h2 class="text-xl font-semibold mb-4 text-center text-slate-700">æ˜æ—¥ã®å¤©æ°—äºˆå ±</h2>
        <div id="weatherResult" class="text-center text-lg text-slate-600 min-h-[3rem] flex items-center justify-center gap-2">
            <span class="weather-icon weather-default"></span>
            <span>å¤©æ°—æƒ…å ±ã‚’å–å¾—ä¸­...</span>
        </div>
    </section>

    <section id="touristSection" class="hidden">
        <h2 class="text-xl font-semibold mb-4 text-center text-slate-700">ãŠã™ã™ã‚è¦³å…‰ã‚¹ãƒãƒƒãƒˆ</h2>
        <div id="touristSpots" class="text-center text-slate-600">
            <ul id="spotsList" class="list-disc list-inside">
                </ul>
        </div>
    </section>

    <section id="diceSection" class="text-center">
      <h2 class="text-xl font-semibold mb-4 text-slate-700">äºˆç®—ãƒ€ã‚¤ã‚¹ã‚’å›ã—ã¦ï¼</h2>
      <div class="mb-4 flex justify-center">
          <img id="diceImage" src="dice-1.png" alt="ã‚µã‚¤ã‚³ãƒ­" width="100" height="100" class="rounded shadow">
      </div>
      <button id="rollDiceBtn" class="bg-amber-500 hover:bg-amber-600 text-white font-bold py-2 px-6 rounded-lg shadow mb-4">
        äºˆç®—ãƒ€ã‚¤ã‚¹ã‚’å›ã™ï¼
      </button>
      <div id="budgetResult" class="text-2xl font-semibold min-h-[3rem] flex items-center justify-center text-amber-700">
        </div>
    </section>

    <section class="text-center mt-8">
      <button id="shareBtn" class="bg-gray-700 hover:bg-gray-800 text-white font-bold py-2 px-5 rounded-lg shadow inline-flex items-center">
        <img src="https://abs.twimg.com/favicons/twitter.2.ico" alt="X(Twitter)ãƒ­ã‚´" class="w-4 h-4 mr-2"> çµæœã‚’ã‚·ã‚§ã‚¢
      </button>
    </section>

  </main>

  <footer class="text-center mt-12 text-slate-500 text-sm">
    <small>&copy; 2025 ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆæ—… NEXT</small>
  </footer>

  <script type="module">
    // --- Constants and Data ---

    // 47éƒ½é“åºœçœŒãƒªã‚¹ãƒˆ
    const prefectures = [
      "åŒ—æµ·é“", "é’æ£®çœŒ", "å²©æ‰‹çœŒ", "å®®åŸçœŒ", "ç§‹ç”°çœŒ", "å±±å½¢çœŒ", "ç¦å³¶çœŒ",
      "èŒ¨åŸçœŒ", "æ ƒæœ¨çœŒ", "ç¾¤é¦¬çœŒ", "åŸ¼ç‰çœŒ", "åƒè‘‰çœŒ", "æ±äº¬éƒ½", "ç¥å¥ˆå·çœŒ",
      "æ–°æ½ŸçœŒ", "å¯Œå±±çœŒ", "çŸ³å·çœŒ", "ç¦äº•çœŒ", "å±±æ¢¨çœŒ", "é•·é‡çœŒ",
      "å²é˜œçœŒ", "é™å²¡çœŒ", "æ„›çŸ¥çœŒ", "ä¸‰é‡çœŒ",
      "æ»‹è³€çœŒ", "äº¬éƒ½åºœ", "å¤§é˜ªåºœ", "å…µåº«çœŒ", "å¥ˆè‰¯çœŒ", "å’Œæ­Œå±±çœŒ",
      "é³¥å–çœŒ", "å³¶æ ¹çœŒ", "å²¡å±±çœŒ", "åºƒå³¶çœŒ", "å±±å£çœŒ",
      "å¾³å³¶çœŒ", "é¦™å·çœŒ", "æ„›åª›çœŒ", "é«˜çŸ¥çœŒ",
      "ç¦å²¡çœŒ", "ä½è³€çœŒ", "é•·å´çœŒ", "ç†Šæœ¬çœŒ", "å¤§åˆ†çœŒ", "å®®å´çœŒ", "é¹¿å…å³¶çœŒ", "æ²–ç¸„çœŒ"
    ];

    // éš£æ¥çœŒãƒãƒƒãƒ—ï¼ˆé™¸ç¶šãã¾ãŸã¯ä¸»è¦ãªæ©‹ãƒ»ãƒˆãƒ³ãƒãƒ«æ¥ç¶šã‚’è€ƒæ…®ï¼‰
    const adjacentPrefectures = {
      "åŒ—æµ·é“": ["é’æ£®çœŒ"],
      "é’æ£®çœŒ": ["åŒ—æµ·é“", "ç§‹ç”°çœŒ", "å²©æ‰‹çœŒ"],
      "å²©æ‰‹çœŒ": ["é’æ£®çœŒ", "ç§‹ç”°çœŒ", "å®®åŸçœŒ"],
      "å®®åŸçœŒ": ["å²©æ‰‹çœŒ", "ç§‹ç”°çœŒ", "å±±å½¢çœŒ", "ç¦å³¶çœŒ"], // ç§‹ç”°è¿½åŠ 
      "ç§‹ç”°çœŒ": ["é’æ£®çœŒ", "å²©æ‰‹çœŒ", "å®®åŸçœŒ", "å±±å½¢çœŒ"], // å®®åŸè¿½åŠ 
      "å±±å½¢çœŒ": ["ç§‹ç”°çœŒ", "å®®åŸçœŒ", "ç¦å³¶çœŒ", "æ–°æ½ŸçœŒ"],
      "ç¦å³¶çœŒ": ["å®®åŸçœŒ", "å±±å½¢çœŒ", "æ ƒæœ¨çœŒ", "ç¾¤é¦¬çœŒ", "èŒ¨åŸçœŒ", "æ–°æ½ŸçœŒ"],
      "èŒ¨åŸçœŒ": ["ç¦å³¶çœŒ", "æ ƒæœ¨çœŒ", "åŸ¼ç‰çœŒ", "åƒè‘‰çœŒ"],
      "æ ƒæœ¨çœŒ": ["ç¦å³¶çœŒ", "ç¾¤é¦¬çœŒ", "èŒ¨åŸçœŒ", "åŸ¼ç‰çœŒ"],
      "ç¾¤é¦¬çœŒ": ["ç¦å³¶çœŒ", "æ ƒæœ¨çœŒ", "åŸ¼ç‰çœŒ", "é•·é‡çœŒ", "æ–°æ½ŸçœŒ"],
      "åŸ¼ç‰çœŒ": ["ç¾¤é¦¬çœŒ", "æ ƒæœ¨çœŒ", "èŒ¨åŸçœŒ", "åƒè‘‰çœŒ", "æ±äº¬éƒ½", "å±±æ¢¨çœŒ", "é•·é‡çœŒ"],
      "åƒè‘‰çœŒ": ["èŒ¨åŸçœŒ", "åŸ¼ç‰çœŒ", "æ±äº¬éƒ½"], // æ©‹/ãƒˆãƒ³ãƒãƒ«è€ƒæ…®
      "æ±äº¬éƒ½": ["åŸ¼ç‰çœŒ", "åƒè‘‰çœŒ", "ç¥å¥ˆå·çœŒ", "å±±æ¢¨çœŒ"],
      "ç¥å¥ˆå·çœŒ": ["æ±äº¬éƒ½", "å±±æ¢¨çœŒ", "é™å²¡çœŒ"],
      "æ–°æ½ŸçœŒ": ["å±±å½¢çœŒ", "ç¦å³¶çœŒ", "ç¾¤é¦¬çœŒ", "é•·é‡çœŒ", "å¯Œå±±çœŒ"], // å¯Œå±±è¿½åŠ 
      "å¯Œå±±çœŒ": ["æ–°æ½ŸçœŒ", "é•·é‡çœŒ", "å²é˜œçœŒ", "çŸ³å·çœŒ"],
      "çŸ³å·çœŒ": ["å¯Œå±±çœŒ", "å²é˜œçœŒ", "ç¦äº•çœŒ"],
      "ç¦äº•çœŒ": ["çŸ³å·çœŒ", "å²é˜œçœŒ", "æ»‹è³€çœŒ", "äº¬éƒ½åºœ"], // äº¬éƒ½è¿½åŠ 
      "å±±æ¢¨çœŒ": ["é™å²¡çœŒ", "ç¥å¥ˆå·çœŒ", "æ±äº¬éƒ½", "åŸ¼ç‰çœŒ", "é•·é‡çœŒ"],
      "é•·é‡çœŒ": ["æ–°æ½ŸçœŒ", "ç¾¤é¦¬çœŒ", "åŸ¼ç‰çœŒ", "å±±æ¢¨çœŒ", "é™å²¡çœŒ", "æ„›çŸ¥çœŒ", "å²é˜œçœŒ", "å¯Œå±±çœŒ"], // æ„›çŸ¥ã€å¯Œå±±è¿½åŠ 
      "å²é˜œçœŒ": ["å¯Œå±±çœŒ", "çŸ³å·çœŒ", "ç¦äº•çœŒ", "æ»‹è³€çœŒ", "ä¸‰é‡çœŒ", "æ„›çŸ¥çœŒ", "é•·é‡çœŒ"], // ä¸‰é‡è¿½åŠ 
      "é™å²¡çœŒ": ["å±±æ¢¨çœŒ", "ç¥å¥ˆå·çœŒ", "æ„›çŸ¥çœŒ", "é•·é‡çœŒ"],
      "æ„›çŸ¥çœŒ": ["å²é˜œçœŒ", "é™å²¡çœŒ", "ä¸‰é‡çœŒ", "é•·é‡çœŒ"], // é•·é‡è¿½åŠ 
      "ä¸‰é‡çœŒ": ["æ»‹è³€çœŒ", "äº¬éƒ½åºœ", "å¥ˆè‰¯çœŒ", "æ„›çŸ¥çœŒ", "å²é˜œçœŒ", "å’Œæ­Œå±±çœŒ"], // äº¬éƒ½ã€å²é˜œè¿½åŠ 
      "æ»‹è³€çœŒ": ["ç¦äº•çœŒ", "å²é˜œçœŒ", "ä¸‰é‡çœŒ", "äº¬éƒ½åºœ"],
      "äº¬éƒ½åºœ": ["æ»‹è³€çœŒ", "ç¦äº•çœŒ", "å¤§é˜ªåºœ", "å…µåº«çœŒ", "å¥ˆè‰¯çœŒ", "ä¸‰é‡çœŒ"], // å…µåº«ã€ä¸‰é‡è¿½åŠ 
      "å¤§é˜ªåºœ": ["äº¬éƒ½åºœ", "å…µåº«çœŒ", "å¥ˆè‰¯çœŒ", "å’Œæ­Œå±±çœŒ"], // å’Œæ­Œå±±è¿½åŠ 
      "å…µåº«çœŒ": ["äº¬éƒ½åºœ", "å¤§é˜ªåºœ", "é³¥å–çœŒ", "å²¡å±±çœŒ", "é¦™å·çœŒ", "å¾³å³¶çœŒ"], // é¦™å·ã€å¾³å³¶è¿½åŠ  (æ©‹)
      "å¥ˆè‰¯çœŒ": ["ä¸‰é‡çœŒ", "äº¬éƒ½åºœ", "å¤§é˜ªåºœ", "å’Œæ­Œå±±çœŒ"],
      "å’Œæ­Œå±±çœŒ": ["ä¸‰é‡çœŒ", "å¥ˆè‰¯çœŒ", "å¤§é˜ªåºœ", "å¾³å³¶çœŒ"], // å¤§é˜ªã€å¾³å³¶è¿½åŠ  (æµ·è·¯è€ƒæ…®)
      "é³¥å–çœŒ": ["å…µåº«çœŒ", "å²¡å±±çœŒ", "å³¶æ ¹çœŒ", "åºƒå³¶çœŒ"], // åºƒå³¶è¿½åŠ 
      "å³¶æ ¹çœŒ": ["é³¥å–çœŒ", "åºƒå³¶çœŒ", "å±±å£çœŒ"],
      "å²¡å±±çœŒ": ["å…µåº«çœŒ", "é³¥å–çœŒ", "åºƒå³¶çœŒ", "é¦™å·çœŒ"], // é¦™å·è¿½åŠ  (æ©‹)
      "åºƒå³¶çœŒ": ["å²¡å±±çœŒ", "é³¥å–çœŒ", "å³¶æ ¹çœŒ", "å±±å£çœŒ", "æ„›åª›çœŒ"], // é³¥å–ã€æ„›åª›è¿½åŠ  (æµ·è·¯è€ƒæ…®)
      "å±±å£çœŒ": ["åºƒå³¶çœŒ", "å³¶æ ¹çœŒ", "ç¦å²¡çœŒ", "å¤§åˆ†çœŒ"], // å¤§åˆ†è¿½åŠ  (æµ·è·¯è€ƒæ…®)
      "å¾³å³¶çœŒ": ["é¦™å·çœŒ", "æ„›åª›çœŒ", "é«˜çŸ¥çœŒ", "å…µåº«çœŒ", "å’Œæ­Œå±±çœŒ"], // æ„›åª›ã€å…µåº«ã€å’Œæ­Œå±±è¿½åŠ  (æ©‹/æµ·è·¯)
      "é¦™å·çœŒ": ["å¾³å³¶çœŒ", "æ„›åª›çœŒ", "å²¡å±±çœŒ", "å…µåº«çœŒ"], // å²¡å±±ã€å…µåº«è¿½åŠ  (æ©‹)
      "æ„›åª›çœŒ": ["é¦™å·çœŒ", "å¾³å³¶çœŒ", "é«˜çŸ¥çœŒ", "åºƒå³¶çœŒ", "å¤§åˆ†çœŒ", "å±±å£çœŒ"], // åºƒå³¶ã€å¤§åˆ†ã€å±±å£è¿½åŠ  (æµ·è·¯è€ƒæ…®)
      "é«˜çŸ¥çœŒ": ["å¾³å³¶çœŒ", "æ„›åª›çœŒ"],
      "ç¦å²¡çœŒ": ["å±±å£çœŒ", "ä½è³€çœŒ", "ç†Šæœ¬çœŒ", "å¤§åˆ†çœŒ"], // ç†Šæœ¬è¿½åŠ 
      "ä½è³€çœŒ": ["ç¦å²¡çœŒ", "é•·å´çœŒ"],
      "é•·å´çœŒ": ["ä½è³€çœŒ", "ç†Šæœ¬çœŒ"], // ç†Šæœ¬è¿½åŠ  (æµ·è·¯è€ƒæ…®)
      "ç†Šæœ¬çœŒ": ["ç¦å²¡çœŒ", "ä½è³€çœŒ", "é•·å´çœŒ", "å¤§åˆ†çœŒ", "å®®å´çœŒ", "é¹¿å…å³¶çœŒ"], // ä½è³€ã€é•·å´è¿½åŠ  (æµ·è·¯è€ƒæ…®)
      "å¤§åˆ†çœŒ": ["ç¦å²¡çœŒ", "ç†Šæœ¬çœŒ", "å®®å´çœŒ", "å±±å£çœŒ", "æ„›åª›çœŒ"], // å±±å£ã€æ„›åª›è¿½åŠ  (æµ·è·¯è€ƒæ…®)
      "å®®å´çœŒ": ["ç†Šæœ¬çœŒ", "å¤§åˆ†çœŒ", "é¹¿å…å³¶çœŒ"],
      "é¹¿å…å³¶çœŒ": ["å®®å´çœŒ", "ç†Šæœ¬çœŒ", "æ²–ç¸„çœŒ"], // æ²–ç¸„è¿½åŠ  (æµ·è·¯è€ƒæ…®)
      "æ²–ç¸„çœŒ": ["é¹¿å…å³¶çœŒ"] // (æµ·è·¯è€ƒæ…®)
    };

    // éƒ½é“åºœçœŒåã¨SVGè¦ç´ IDã®ãƒãƒƒãƒ”ãƒ³ã‚°
    const prefectureIdMap = {
      "åŒ—æµ·é“": "JP01", "é’æ£®çœŒ": "JP02", "å²©æ‰‹çœŒ": "JP03", "å®®åŸçœŒ": "JP04", "ç§‹ç”°çœŒ": "JP05",
      "å±±å½¢çœŒ": "JP06", "ç¦å³¶çœŒ": "JP07", "èŒ¨åŸçœŒ": "JP08", "æ ƒæœ¨çœŒ": "JP09", "ç¾¤é¦¬çœŒ": "JP10",
      "åŸ¼ç‰çœŒ": "JP11", "åƒè‘‰çœŒ": "JP12", "æ±äº¬éƒ½": "JP13", "ç¥å¥ˆå·çœŒ": "JP14",
      "æ–°æ½ŸçœŒ": "JP15", "å¯Œå±±çœŒ": "JP16", "çŸ³å·çœŒ": "JP17", "ç¦äº•çœŒ": "JP18", "å±±æ¢¨çœŒ": "JP19",
      "é•·é‡çœŒ": "JP20", "å²é˜œçœŒ": "JP21", "é™å²¡çœŒ": "JP22", "æ„›çŸ¥çœŒ": "JP23", "ä¸‰é‡çœŒ": "JP24",
      "æ»‹è³€çœŒ": "JP25", "äº¬éƒ½åºœ": "JP26", "å¤§é˜ªåºœ": "JP27", "å…µåº«çœŒ": "JP28", "å¥ˆè‰¯çœŒ": "JP29",
      "å’Œæ­Œå±±çœŒ": "JP30", "é³¥å–çœŒ": "JP31", "å³¶æ ¹çœŒ": "JP32", "å²¡å±±çœŒ": "JP33", "åºƒå³¶çœŒ": "JP34",
      "å±±å£çœŒ": "JP35", "å¾³å³¶çœŒ": "JP36", "é¦™å·çœŒ": "JP37", "æ„›åª›çœŒ": "JP38", "é«˜çŸ¥çœŒ": "JP39",
      "ç¦å²¡çœŒ": "JP40", "ä½è³€çœŒ": "JP41", "é•·å´çœŒ": "JP42", "ç†Šæœ¬çœŒ": "JP43", "å¤§åˆ†çœŒ": "JP44",
      "å®®å´çœŒ": "JP45", "é¹¿å…å³¶çœŒ": "JP46", "æ²–ç¸„çœŒ": "JP47"
    };

    // ã‚µãƒ³ãƒ—ãƒ«è¦³å…‰åœ°ãƒ‡ãƒ¼ã‚¿ (éƒ½é“åºœçœŒåã‚’ã‚­ãƒ¼ã¨ã™ã‚‹)
    const touristData = {
        "åŒ—æµ·é“": ["æœ­å¹Œæ™‚è¨ˆå°", "å‡½é¤¨å±±", "å¯Œè‰¯é‡ã®ãƒ©ãƒ™ãƒ³ãƒ€ãƒ¼ç•‘", "æ—­å±±å‹•ç‰©åœ’"],
        "é’æ£®çœŒ": ["å¼˜å‰åŸ", "å¥¥å…¥ç€¬æ¸“æµ", "ã­ã¶ãŸã®å®¶ ãƒ¯ãƒ»ãƒ©ãƒƒã‚»"],
        "å²©æ‰‹çœŒ": ["ä¸­å°Šå¯ºé‡‘è‰²å ‚", "é¾æ³‰æ´", "å°å²©äº•è¾²å ´"],
        "å®®åŸçœŒ": ["æ¾å³¶", "ç‘å·Œå¯º", "ä»™å°åŸè·¡"],
        "ç§‹ç”°çœŒ": ["è§’é¤¨æ­¦å®¶å±‹æ•·", "ç”°æ²¢æ¹–", "ç”·é¹¿åŠå³¶ (ãªã¾ã¯ã’é¤¨)"],
        "å±±å½¢çœŒ": ["å±±å¯º (ç«‹çŸ³å¯º)", "éŠ€å±±æ¸©æ³‰", "è”µç‹ã®æ¨¹æ°·"],
        "ç¦å³¶çœŒ": ["ä¼šæ´¥è‹¥æ¾åŸ (é¶´ãƒ¶åŸ)", "å¤§å†…å®¿", "äº”è‰²æ²¼"],
        "èŒ¨åŸçœŒ": ["å•æ¥½åœ’", "å›½å–¶ã²ãŸã¡æµ·æµœå…¬åœ’", "è¢‹ç”°ã®æ»"],
        "æ ƒæœ¨çœŒ": ["æ—¥å…‰æ±ç…§å®®", "è¯å³ã®æ»", "ä¸­ç¦…å¯ºæ¹–"],
        "ç¾¤é¦¬çœŒ": ["è‰æ´¥æ¸©æ³‰", "å¯Œå²¡è£½ç³¸å ´", "ä¼Šé¦™ä¿æ¸©æ³‰"],
        "åŸ¼ç‰çœŒ": ["å·è¶Š (è”µé€ ã‚Šã®ç”ºä¸¦ã¿)", "é‰„é“åšç‰©é¤¨", "é•·ç€"],
        "åƒè‘‰çœŒ": ["æ±äº¬ãƒ‡ã‚£ã‚ºãƒ‹ãƒ¼ãƒªã‚¾ãƒ¼ãƒˆ", "æˆç”°å±±æ–°å‹å¯º", "é´¨å·ã‚·ãƒ¼ãƒ¯ãƒ¼ãƒ«ãƒ‰"],
        "æ±äº¬éƒ½": ["æµ…è‰å¯ºãƒ»é›·é–€", "æ¸‹è°·ã‚¹ã‚¯ãƒ©ãƒ³ãƒ–ãƒ«äº¤å·®ç‚¹", "æ±äº¬ã‚¿ãƒ¯ãƒ¼", "æ–°å®¿å¾¡è‹‘"],
        "ç¥å¥ˆå·çœŒ": ["ç®±æ ¹", "æ¨ªæµœä¸­è¯è¡—", "éŒå€‰ (å¤§ä»ãƒ»é¶´å²¡å…«å¹¡å®®)"],
        "æ–°æ½ŸçœŒ": ["ä½æ¸¡å³¶ (ãŸã‚‰ã„èˆŸ)", "æ¸…æ´¥å³¡", "è¶Šå¾Œæ¹¯æ²¢æ¸©æ³‰"],
        "å¯Œå±±çœŒ": ["ç«‹å±±é»’éƒ¨ã‚¢ãƒ«ãƒšãƒ³ãƒ«ãƒ¼ãƒˆ", "äº”ç®‡å±±åˆæŒé€ ã‚Šé›†è½", "é»’éƒ¨ãƒ€ãƒ "],
        "çŸ³å·çœŒ": ["å…¼å…­åœ’", "ã²ãŒã—èŒ¶å±‹è¡—", "é‡‘æ²¢21ä¸–ç´€ç¾è¡“é¤¨"],
        "ç¦äº•çœŒ": ["æ±å°‹åŠ", "ç¦äº•çœŒç«‹æç«œåšç‰©é¤¨", "æ°¸å¹³å¯º"],
        "å±±æ¢¨çœŒ": ["å¯Œå£«å±±", "æ²³å£æ¹–", "å¿é‡å…«æµ·"],
        "é•·é‡çœŒ": ["å–„å…‰å¯º", "æ¾æœ¬åŸ", "ä¸Šé«˜åœ°"],
        "å²é˜œçœŒ": ["ç™½å·éƒ·", "é£›é¨¨é«˜å±± (å¤ã„ç”ºä¸¦)", "ä¸‹å‘‚æ¸©æ³‰"],
        "é™å²¡çœŒ": ["å¯Œå£«å±±", "ä¼Šè±†åŠå³¶ (æ¸©æ³‰ãƒ»æµ·å²¸)", "ä¹…èƒ½å±±æ±ç…§å®®"],
        "æ„›çŸ¥çœŒ": ["åå¤å±‹åŸ", "ç†±ç”°ç¥å®®", "ãƒˆãƒ¨ã‚¿ç”£æ¥­æŠ€è¡“è¨˜å¿µé¤¨"],
        "ä¸‰é‡çœŒ": ["ä¼Šå‹¢ç¥å®®", "é³¥ç¾½æ°´æ—é¤¨", "ãŠã‹ã’æ¨ªä¸"],
        "æ»‹è³€çœŒ": ["çµç¶æ¹–", "å½¦æ ¹åŸ", "æ¯”å¡å±±å»¶æš¦å¯º"],
        "äº¬éƒ½åºœ": ["æ¸…æ°´å¯º", "é‡‘é–£å¯º", "ä¼è¦‹ç¨²è·å¤§ç¤¾", "åµå±±"],
        "å¤§é˜ªåºœ": ["å¤§é˜ªåŸ", "é“é “å €", "ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ãƒ»ã‚¹ã‚¿ã‚¸ã‚ªãƒ»ã‚¸ãƒ£ãƒ‘ãƒ³"],
        "å…µåº«çœŒ": ["å§«è·¯åŸ", "ç¥æˆ¸æ¸¯ (ãƒ¡ãƒªã‚±ãƒ³ãƒ‘ãƒ¼ã‚¯ãƒ»ãƒãƒ¼ãƒãƒ¼ãƒ©ãƒ³ãƒ‰)", "æœ‰é¦¬æ¸©æ³‰"],
        "å¥ˆè‰¯çœŒ": ["æ±å¤§å¯º (å¤§ä»)", "å¥ˆè‰¯å…¬åœ’ (é¹¿)", "æ³•éš†å¯º"],
        "å’Œæ­Œå±±çœŒ": ["é«˜é‡å±±", "ç†Šé‡å¤é“", "ã‚¢ãƒ‰ãƒ™ãƒ³ãƒãƒ£ãƒ¼ãƒ¯ãƒ¼ãƒ«ãƒ‰"],
        "é³¥å–çœŒ": ["é³¥å–ç ‚ä¸˜", "æ°´æœ¨ã—ã’ã‚‹ãƒ­ãƒ¼ãƒ‰", "ä¸‰å¾³å±±ä¸‰ä½›å¯ºæŠ•å…¥å ‚"],
        "å³¶æ ¹çœŒ": ["å‡ºé›²å¤§ç¤¾", "æ¾æ±ŸåŸ", "çŸ³è¦‹éŠ€å±±"],
        "å²¡å±±çœŒ": ["å²¡å±±å¾Œæ¥½åœ’", "å€‰æ•·ç¾è¦³åœ°åŒº", "å²¡å±±åŸ"],
        "åºƒå³¶çœŒ": ["å³å³¶ç¥ç¤¾", "åŸçˆ†ãƒ‰ãƒ¼ãƒ ãƒ»å¹³å’Œè¨˜å¿µå…¬åœ’", "å°¾é“"],
        "å±±å£çœŒ": ["è§’å³¶å¤§æ©‹", "å…ƒä¹ƒéš…ç¥ç¤¾", "ç§‹èŠ³æ´"],
        "å¾³å³¶çœŒ": ["é³´é–€ã®æ¸¦æ½®", "å¤§æ­©å±ãƒ»å°æ­©å±", "é˜¿æ³¢ãŠã©ã‚Šä¼šé¤¨"],
        "é¦™å·çœŒ": ["é‡‘åˆ€æ¯”ç¾…å®®", "æ —æ—å…¬åœ’", "ç›´å³¶ (ã‚¢ãƒ¼ãƒˆ)"],
        "æ„›åª›çœŒ": ["é“å¾Œæ¸©æ³‰", "æ¾å±±åŸ", "ã—ã¾ãªã¿æµ·é“"],
        "é«˜çŸ¥çœŒ": ["æ¡‚æµœ", "å››ä¸‡åå·", "é«˜çŸ¥åŸ"],
        "ç¦å²¡çœŒ": ["å¤ªå®°åºœå¤©æº€å®®", "åšå¤š (å±‹å°ãƒ»ä¸­æ´²)", "é–€å¸æ¸¯ãƒ¬ãƒˆãƒ­"],
        "ä½è³€çœŒ": ["å‰é‡ãƒ¶é‡Œæ­´å²å…¬åœ’", "å¬‰é‡æ¸©æ³‰", "æœ‰ç”°ç„¼ (é™¶å±±ç¥ç¤¾)"],
        "é•·å´çœŒ": ["ã‚°ãƒ©ãƒãƒ¼åœ’", "å¹³å’Œå…¬åœ’", "ãƒã‚¦ã‚¹ãƒ†ãƒ³ãƒœã‚¹"],
        "ç†Šæœ¬çœŒ": ["ç†Šæœ¬åŸ", "é˜¿è˜‡å±±", "é»’å·æ¸©æ³‰"],
        "å¤§åˆ†çœŒ": ["åˆ¥åºœæ¸©æ³‰ (åœ°ç„ã‚ãã‚Š)", "ç”±å¸ƒé™¢æ¸©æ³‰", "å®‡ä½ç¥å®®"],
        "å®®å´çœŒ": ["é«˜åƒç©‚å³¡", "é’å³¶ç¥ç¤¾", "ã‚µãƒ³ãƒ¡ãƒƒã‚»æ—¥å—"],
        "é¹¿å…å³¶çœŒ": ["æ¡œå³¶", "å±‹ä¹…å³¶", "æŒ‡å®¿æ¸©æ³‰ (ç ‚ã‚€ã—é¢¨å‘‚)"],
        "æ²–ç¸„çœŒ": ["æ²–ç¸„ç¾ã‚‰æµ·æ°´æ—é¤¨", "é¦–é‡ŒåŸå…¬åœ’", "å›½éš›é€šã‚Š"]
    };

    // --- DOM Elements ---
    const startPrefSelect = document.getElementById('startPref');
    const destinationBtn = document.getElementById('destinationBtn');
    const destinationResultDiv = document.getElementById('destinationResult');
    const mapContainer = document.getElementById('mapContainer');
    const diceImage = document.getElementById('diceImage');
    const rollDiceBtn = document.getElementById('rollDiceBtn');
    const budgetResultDiv = document.getElementById('budgetResult');
    const shareBtn = document.getElementById('shareBtn');
    const weatherSection = document.getElementById('weatherSection');
    const weatherResultDiv = document.getElementById('weatherResult');
    const touristSection = document.getElementById('touristSection');
    const spotsListUl = document.getElementById('spotsList');

    // --- State Variables ---
    let currentDestination = null;
    let currentBudget = null;
    let currentStartPref = null;
    let diceAnimationInterval = null;
    let isRollingDice = false;

    // --- Initialization ---

    // Populate start prefecture dropdown
    prefectures.forEach(pref => {
      const option = document.createElement('option');
      option.value = pref;
      option.textContent = pref;
      startPrefSelect.appendChild(option);
    });
    // Set default start prefecture (e.g., Tokyo or first in list)
    currentStartPref = prefectures[12]; // Tokyo
    startPrefSelect.value = currentStartPref;


    // Load SVG Map
    fetch('japan-map.svg')
      .then(response => {
          if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
          }
          return response.text();
      })
      .then(svgText => {
        // Wrap SVG to control styling and prevent layout shifts
        const wrapper = document.createElement('div');
        wrapper.className = 'svg-wrapper';
        wrapper.innerHTML = svgText;
        mapContainer.innerHTML = ''; // Clear loading message
        mapContainer.appendChild(wrapper);

        // Add click event listeners to map paths/circles after loading
        setupMapClickListeners();
        // Highlight initial start prefecture
        highlightPrefecture(currentStartPref, 'start-prefecture');
      })
      .catch(error => {
          console.error('Error loading SVG map:', error);
          mapContainer.innerHTML = '<p class="text-red-500 text-center">åœ°å›³ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p>';
      });

    // --- Event Listeners ---

    // Start prefecture selection change
    startPrefSelect.addEventListener('change', (e) => {
        currentStartPref = e.target.value;
        highlightPrefecture(currentStartPref, 'start-prefecture'); // Highlight new start point
        // Reset destination and other results if start changes
        resetResults();
    });

    // Destination Roulette Button
    destinationBtn.addEventListener('click', () => {
      const start = startPrefSelect.value;
      if (!start) {
          alert('ã¾ãšã‚¹ã‚¿ãƒ¼ãƒˆåœ°ç‚¹ã‚’é¸ã‚“ã§ãã ã•ã„ï¼');
          return;
      }
      // Filter out the starting prefecture itself
      const candidates = (adjacentPrefectures[start] || prefectures).filter(p => p !== start);
      if (candidates.length === 0) {
          // Handle cases like isolated islands if necessary, or just use all prefectures
          candidates = prefectures.filter(p => p !== start);
      }

      const randomIndex = Math.floor(Math.random() * candidates.length);
      currentDestination = candidates[randomIndex];

      destinationResultDiv.textContent = `æ¬¡ã®è¡Œãå…ˆã¯ã€Œ${currentDestination}ã€ï¼`;
      highlightPrefecture(currentDestination, 'highlighted-prefecture'); // Highlight destination
      fetchWeather(currentDestination); // Fetch weather for the destination
      displayTouristSpots(currentDestination); // Show tourist spots
      weatherSection.classList.remove('hidden'); // Show weather section
      touristSection.classList.remove('hidden'); // Show tourist section
    });

    // Budget Dice Roll Button
    rollDiceBtn.addEventListener('click', () => {
        if (isRollingDice) return; // Prevent multiple rolls at once
        isRollingDice = true;
        rollDiceBtn.disabled = true; // Disable button during roll
        diceImage.classList.add('dice-rolling'); // Add rolling animation class
        budgetResultDiv.textContent = 'é‹å‘½ã®ãƒ€ã‚¤ã‚¹ãƒ­ãƒ¼ãƒ«...ï¼';

        let rollCount = 0;
        const maxRolls = 20; // Number of quick changes for animation
        const rollInterval = 100; // ms between changes

        diceAnimationInterval = setInterval(() => {
            const randomFace = Math.floor(Math.random() * 6) + 1;
            diceImage.src = `dice-${randomFace}.png`;
            rollCount++;
            if (rollCount >= maxRolls) {
                clearInterval(diceAnimationInterval);
                finalizeDiceRoll();
            }
        }, rollInterval);
    });

    // Share Button
    shareBtn.addEventListener('click', () => {
        let text = "ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆæ—…ï¼";
        if (currentDestination) {
            text += ` æ¬¡ã®è¡Œãå…ˆã¯ã€Œ${currentDestination}ã€ï¼`;
        }
        if (currentBudget) {
             text += ` æ¬¡ã®æ—¥ã®äºˆç®—ã¯ ${currentBudget}å††ï¼`;
        }
        text += " #ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆæ—…NEXT"; // Add hashtag

        const url = encodeURIComponent(window.location.href); // Share the current page URL
        const shareURL = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${url}`;
        window.open(shareURL, '_blank');
    });

    // --- Functions ---

    // Add click listeners to SVG map elements
    function setupMapClickListeners() {
        mapContainer.querySelectorAll('path, circle').forEach(el => {
            el.addEventListener('click', (e) => {
                const clickedId = e.target.id || (e.target.parentNode && e.target.parentNode.id); // Handle clicks on text within path sometimes
                const prefName = Object.keys(prefectureIdMap).find(name => prefectureIdMap[name] === clickedId);
                if (prefName) {
                    startPrefSelect.value = prefName;
                    // Manually trigger the change event to update state and highlight
                    startPrefSelect.dispatchEvent(new Event('change'));
                }
            });
        });
    }

    // Finalize the dice roll after animation
    function finalizeDiceRoll() {
        const finalDiceValue = Math.floor(Math.random() * 6) + 1;
        currentBudget = finalDiceValue * 10000;

        diceImage.src = `dice-${finalDiceValue}.png`; // Set final image
        diceImage.classList.remove('dice-rolling'); // Remove animation class
        budgetResultDiv.textContent = `æ¬¡ã®æ—¥ã®äºˆç®—ã¯ ${currentBudget.toLocaleString()}å††ã ã‚ˆï¼`; // Display result immediately
        isRollingDice = false; // Re-enable rolling
        rollDiceBtn.disabled = false; // Re-enable button
    }

    // Highlight prefecture on the map
    function highlightPrefecture(prefectureName, highlightClass) {
        const prefId = prefectureIdMap[prefectureName];
        if (!prefId) return;

        // Remove existing highlights of the same type, except for start-prefecture
        document.querySelectorAll(`.${highlightClass}:not(.start-prefecture)`).forEach(el => {
             if (highlightClass !== 'start-prefecture' || el.id !== prefectureIdMap[currentStartPref]) {
                el.classList.remove(highlightClass);
                // Reset fill if it's not the start prefecture
                if (el.id !== prefectureIdMap[currentStartPref]) {
                   el.style.fill = ''; // Reset to default CSS fill
                }
             }
        });
         // Remove start-prefecture highlight if a new start is selected
         if (highlightClass === 'start-prefecture') {
            document.querySelectorAll('.start-prefecture').forEach(el => {
                if (el.id !== prefId) {
                    el.classList.remove('start-prefecture');
                    el.style.fill = ''; // Reset fill
                }
            });
         }


        const selectedElement = mapContainer.querySelector(`#${prefId}`);
        if (selectedElement) {
            selectedElement.classList.add(highlightClass);
            // Ensure start prefecture color overrides destination if they are the same
            if (highlightClass === 'start-prefecture') {
                 selectedElement.style.fill = '#f59e0b'; // Amber-500
            } else if (!selectedElement.classList.contains('start-prefecture')) {
                 selectedElement.style.fill = '#3b82f6'; // Blue-500
            }
        } else {
            console.warn(`Element with ID ${prefId} not found in SVG.`);
        }
    }

    // Fetch and display weather (Placeholder)
    function fetchWeather(prefectureName) {
        weatherResultDiv.innerHTML = '<span class="weather-icon weather-default"></span><span>å¤©æ°—æƒ…å ±ã‚’å–å¾—ä¸­...</span>'; // Show loading state

        // --- !!! API Integration Point !!! ---
        // Replace this setTimeout with an actual fetch call to a weather API
        // Example using OpenWeatherMap (requires API key and setup):
        // const apiKey = 'YOUR_API_KEY';
        // const url = `https://api.openweathermap.org/data/2.5/weather?q=${prefectureName},JP&appid=${apiKey}&units=metric&lang=ja`;
        // fetch(url)
        //   .then(response => response.json())
        //   .then(data => {
        //     const weather = data.weather[0].description;
        //     const temp = data.main.temp;
        //     const iconCode = data.weather[0].icon; // Use this for specific icons
        //     // Determine weather class based on description/iconCode
        //     let weatherClass = 'weather-default';
        //     if (iconCode.includes('01')) weatherClass = 'weather-sunny';
        //     else if (iconCode.includes('02') || iconCode.includes('03') || iconCode.includes('04')) weatherClass = 'weather-cloudy';
        //     else if (iconCode.includes('09') || iconCode.includes('10') || iconCode.includes('11')) weatherClass = 'weather-rainy';
        //     else if (iconCode.includes('13')) weatherClass = 'weather-snowy';
        //
        //     weatherResultDiv.innerHTML = `<span class="weather-icon ${weatherClass}"></span> ${weather} / ${Math.round(temp)}â„ƒ`;
        //   })
        //   .catch(error => {
        //      console.error('Error fetching weather:', error);
        //      weatherResultDiv.innerHTML = '<span class="weather-icon weather-default"></span> å¤©æ°—æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ';
        //   });
        // --------------------------------------

        // Placeholder implementation:
        setTimeout(() => {
            const dummyWeather = ["sunny", "cloudy", "rainy", "snowy"];
            const randomWeather = dummyWeather[Math.floor(Math.random() * dummyWeather.length)];
            const randomTemp = Math.floor(Math.random() * 25) + 5; // Random temp between 5 and 30
            let weatherText = "æ™´ã‚Œ";
            let weatherClass = "weather-sunny";

            switch (randomWeather) {
                case "cloudy":
                    weatherText = "ãã‚‚ã‚Š";
                    weatherClass = "weather-cloudy";
                    break;
                case "rainy":
                    weatherText = "é›¨";
                    weatherClass = "weather-rainy";
                    break;
                 case "snowy":
                    weatherText = "é›ª";
                    weatherClass = "weather-snowy";
                    break;
            }
            weatherResultDiv.innerHTML = `<span class="weather-icon ${weatherClass}"></span> ${weatherText} / äºˆæƒ³æ°—æ¸© ${randomTemp}â„ƒ`;
        }, 1000); // Simulate network delay
    }

    // Display tourist spots
    function displayTouristSpots(prefectureName) {
        spotsListUl.innerHTML = ''; // Clear previous list
        const spots = touristData[prefectureName] || ["æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ"];
        const spotsToShow = spots.slice(0, 4); // Show up to 4 spots

        spotsToShow.forEach(spot => {
            const li = document.createElement('li');
            li.textContent = spot;
            li.classList.add('mb-1'); // Add some spacing
            spotsListUl.appendChild(li);
        });
        touristSection.classList.remove('hidden');
    }

    // Reset results when start prefecture changes
    function resetResults() {
        currentDestination = null;
        currentBudget = null;
        destinationResultDiv.textContent = '';
        budgetResultDiv.textContent = '';
        weatherSection.classList.add('hidden');
        touristSection.classList.add('hidden');
        weatherResultDiv.innerHTML = '';
        spotsListUl.innerHTML = '';
        // Reset map highlights except for the new start prefecture
        document.querySelectorAll('#mapContainer path.highlighted-prefecture, #mapContainer circle.highlighted-prefecture').forEach(el => {
             el.classList.remove('highlighted-prefecture');
             if (!el.classList.contains('start-prefecture')) {
                 el.style.fill = ''; // Reset fill only if it's not the start prefecture
             }
        });
    }

  </script>
</body>
</html>
